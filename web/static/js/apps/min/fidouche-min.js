$(function($){function e(){if($("#auto_calc").bootstrapSwitch("state")===!0){var e=$("#id_commission_percentage"),t=$("#id_gross"),a=$("#id_fee"),s=$("#id_commission"),i=$("#id_sound_cost"),o=$("#id_in_ears_cost").find("option:selected"),n=$("#id_print_ship_cost"),c=$("#id_ads_cost"),l=$("#id_other_cost"),r=$("#id_net"),d=$("#max_payout"),_=$("#id_payout"),h=$("#id_to_account"),p=parseFloat(t.val())||0,u=parseFloat(e.val())||0,m=parseFloat(i.val())||0,v=parseFloat(o.val())||0,f=parseFloat(n.val())||0,g=parseFloat(c.val())||0,F=parseFloat(l.val())||0,b=parseFloat(_.val())||0,k,y,x,T="",w;p>0&&(w=a.val()>0?a.val():p,k=(parseFloat((w-m)*(u/100))||0).toFixed(2),y=(parseFloat(p-k-(m+v+f+g+F))||0).toFixed(2),T=(parseFloat(y/14)||0).toFixed(2),x=(parseFloat(y-14*b)||0).toFixed(2)),s.val(k).change(),d.html(T),r.val(y).change(),h.val(x).change()}}function t(){var e=0,t=0,a=0,i=0;$("#expenses_formset tbody tr").each(function(){var s=$(this).find(".category option:selected").val(),o=parseFloat($(this).find(".expense-amount input").val())||0;switch(s){case"print":e+=o;break;case"ship":t+=o;break;case"ads":a+=o;break;default:return void(i+=o)}}),e+t!==0&&$("#id_print_ship_cost").val(e+t).change(),0!==a&&$("#id_ads_cost").val(a).change(),0!==i&&$("#id_other_cost").val(i).change(),s()}function a(e,t){var a=$(e).clone(!0),s=$("#id_"+t+"-TOTAL_FORMS").val();a.find(":input").each(function(){var e=$(this).attr("name").replace("-"+(s-1)+"-","-"+s+"-"),t="id_"+e;$(this).attr({name:e,id:t}).val("").removeAttr("checked")}),a.find("label").each(function(){var e=$(this).attr("for").replace("-"+(s-1)+"-","-"+s+"-");$(this).attr("for",e)}),s++,$("#id_"+t+"-TOTAL_FORMS").val(s),$(e).after(a)}var s=_.throttle(e,500);$(".factor").on("blur","input, select",function(){s()}),$(".set-payer").on("change","#id_payer",function(){"agent"==$(this).find("option:selected").val()?$("#commission_withheld").fadeIn("fast"):$("#commission_withheld").fadeOut("fast")}),$("#commission_withheld").on("change","#id_commission_withheld",function(){$(this).is(":checked")?$("#commission_check").fadeOut("fast"):$("#commission_check").fadeIn("fast")}),$(".payment-method").on("change","#id_gross_method",function(){"check"==$(this).find("option:selected").val()?$("#payment_check_no").fadeIn("fast"):$("#payment_check_no").fadeOut("fast")}),$(".set-payout").on("blur","#id_payout",function(){$("#payment_formset .amount input").val($(this).val()).change()}),$(".warn").on("change","input",function(){var e=$(this).parents(".form-group");e.removeClass("has-error"),$(this).val()&&parseFloat($(this).val())<0&&e.addClass("has-error")}),$("#itemize_toggle").click(function(){$(this).hasClass("active")?($("#id_costs_itemized").val("False").change(),$(".expenses-summed input").removeAttr("readonly")):($("#id_costs_itemized").val("True").change(),$(".expenses-summed input").attr("readonly","readonly")),$("#itemize").collapse("toggle"),$(this).blur()}),$("#subs_toggle").click(function(){$(this).hasClass("active")?$("#id_subs").val("False").change():$("#id_subs").val("True").change(),$("#sub_payment").collapse("toggle"),$(this).blur()}),$("#buyouts_toggle").click(function(){$(this).hasClass("active")?$("#id_gross_itemized").val("False").change():$("#id_gross_itemized").val("True").change(),$("#buyouts").collapse("toggle"),$(this).blur()}),$("#expenses_formset").on("blur",".expense-amount input, .category select",function(){t()}),$("#add_expense_rows").click(function(){a("#expenses_formset tr:last","expense")}),$("#payment_check_all").change(function(){$(this).prop("checked")?$(".paid input").prop("checked",!0):$(".paid input").prop("checked",!1)}),"True"==$("#id_costs_itemized").val()&&$("#itemize_toggle").click(),"True"==$("#id_subs").val()&&$("#subs_toggle").click(),"True"==$("#id_gross_itemized").val()&&$("#buyouts_toggle").click(),$("#auto_calc").bootstrapSwitch()});