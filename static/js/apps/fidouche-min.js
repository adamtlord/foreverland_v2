!function(){"use strict";
/* global FL */
/* global _ */
/* global Cookies */$(function(e){
// Methods
function t(){if(!0===e("#auto_calc").bootstrapSwitch("state")){var t=e("#id_commission_percentage"),a=e("#id_gross"),o=e("#id_fee"),s=e("#id_commission"),n=e("#id_print_ship_cost"),c=e("#id_ads_cost"),r=e("#id_other_cost"),l=e("#id_net"),d=e("#max_payout"),u=e("#id_to_account"),_=e("#tour_expense_share"),h=0,p=0;e(".production-cost").each(function(t,a){var i=parseFloat(e(a).val()||0);e("#id_production_payment-"+t+"-category").val()===FL.VARS.iem_cat?p+=i:h+=i});
// payable
var m=parseFloat(a.val())||0,f=parseFloat(t.val())||0,v=h,g=p,y=parseFloat(n.val())||0,k=parseFloat(c.val())||0,b=parseFloat(r.val())||0,F=parseFloat(_.val())||0,x,C,T,w="",z;m>0&&(
// base commission off fee
z=o.val()>0?o.val():m,x=(parseFloat(f/100*(z-v))||0).toFixed(2),C=(parseFloat(m-x-(v+g+y+k+b+F))||0).toFixed(2),w=(parseFloat(C/13)||0).toFixed(2),T=(parseFloat(C-i())||0).toFixed(2)),s.val(x).change(),d.html(w).parent().fadeIn("fast"),l.val(C).change(),u.val(T).change(),e("#id_commission_withheld").is(":checked")&&e("#commission_check").fadeOut("fast")}}function a(){var t=0,a=0,i=0,o=0;e("#expenses_formset tbody tr").each(function(){var s=e(this).find(".category option:selected").val(),n=parseFloat(e(this).find(".expense-amount input").val())||0;switch(s){case"print":t+=n;break;case"ship":a+=n;break;case"ads":i+=n;break;default:return void(o+=n)}}),t+a!==0&&e("#id_print_ship_cost").val(t+a).change(),0!==i&&e("#id_ads_cost").val(i).change(),0!==o&&e("#id_other_cost").val(o.toFixed(2)).change(),s()}function i(){var t=0;return e("#payment_formset .amount input, #sub_payment_formset .amount input").each(function(){t+=Number(e(this).val())}),t}function o(t,a){var i=e(t).clone(!0),o=e("#id_"+a+"-TOTAL_FORMS").val();i.find(":input").each(function(){var t=e(this).attr("name").replace("-"+(o-1)+"-","-"+o+"-"),a="id_"+t;e(this).attr({name:t,id:a}).val("").removeAttr("checked")}),i.find("label").each(function(){var t=e(this).attr("for").replace("-"+(o-1)+"-","-"+o+"-");e(this).attr("for",t)}),o++,e("#id_"+a+"-TOTAL_FORMS").val(o),e(t).after(i)}
// Handlers //
var s=_.throttle(t,500);e(".factor").on("blur","input, select",function(){s()}),e("#commission_withheld").on("change","#id_commission_withheld",function(){e(this).is(":checked")?e("#commission_check").fadeOut("fast"):e("#commission_check").fadeIn("fast")}),e(".payment-method").on("change","#id_gross_method",function(){"check"===e(this).find("option:selected").val()?e("#payment_check_no").fadeIn("fast"):e("#payment_check_no").fadeOut("fast")}),e(".set-payout").on("blur","#id_payout",function(){var t=e(this).val();e("#payment_formset tr").each(function(){e(this).find(".member select").val()&&e(this).find(".amount input").val(t).change()}),s()}),e(".warn").on("change","input",function(){var t=e(this).parents(".form-group");t.removeClass("has-error"),e(this).val()&&parseFloat(e(this).val())<0&&t.addClass("has-error")}),e("#itemize_toggle").click(function(){e(this).hasClass("active")?(e("#id_costs_itemized").val("False").change(),e(".expenses-summed input").removeAttr("readonly")):(e("#id_costs_itemized").val("True").change(),e(".expenses-summed input").attr("readonly","readonly")),e("#itemize").collapse("toggle"),e(this).blur()}),e("#subs_toggle").click(function(){e(this).hasClass("active")?e("#id_subs").val("False").change():e("#id_subs").val("True").change(),e("#sub_payment").collapse("toggle"),e(this).blur()}),e("#buyouts_toggle").click(function(){e(this).hasClass("active")?e("#id_gross_itemized").val("False").change():e("#id_gross_itemized").val("True").change(),e("#buyouts").collapse("toggle"),e(this).blur()}),e("#expenses_formset").on("blur",".expense-amount input, .category select",function(){a()}),e("#add_expense_rows").click(function(){o("#expenses_formset tr:last","expense")}),e("#add_production_payments").click(function(){o("#gig_production tr:last","production_payment")}),e("#add_fiduciary_payments").click(function(){o("#gig_fidouche tr:last","fiduciary_payment")}),e("#payment_check_all").change(function(){e(this).prop("checked")?e(".paid input").prop("checked",!0):e(".paid input").prop("checked",!1)}),
// On load //
"True"===e("#id_costs_itemized").val()&&e("#itemize_toggle").click(),"True"===e("#id_subs").val()&&e("#subs_toggle").click(),"True"===e("#id_gross_itemized").val()&&e("#buyouts_toggle").click();var n="false"!==Cookies.get("autoCalc");e("#auto_calc").attr("checked",n),e("#auto_calc").bootstrapSwitch({onSwitchChange:function(e,t){Cookies.set("autoCalc",t),t&&s()}}).trigger("change"),e(document).ready(function(){s()})})}();